<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<title>‡∏à‡∏±‡∏ö‡∏ö‡∏±‡∏î‡∏î‡∏µ‡πâ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô + ‡∏•‡πâ‡∏≤‡∏á)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; background:#f7fafc; color:#222; padding:18px; }
.card { background:#fff; border-radius:12px; padding:18px; box-shadow:0 6px 18px rgba(0,0,0,0.06); max-width:500px; margin:20px auto; }
h1 { font-size:22px; margin-bottom:10px; }
input, button { font-size:16px; padding:8px 10px; border-radius:8px; border:1px solid #ccc; }
button { background:#2b6cb0; color:#fff; border:none; cursor:pointer; }
button.ghost { background:#edf2f7; color:#222; border:1px solid #ccc; }
.row { display:flex; gap:8px; align-items:center; margin-top:10px; flex-wrap:wrap; }
.status { margin-top:12px; padding:10px; border-radius:8px; background:#f1f5f9; }
.result { margin-top:12px; font-weight:600; font-size:18px; }
</style>
</head>
<body>
<div class="card">
<h1>üéØ ‡∏à‡∏±‡∏ö‡∏ö‡∏±‡∏î‡∏î‡∏µ‡πâ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>
<p>‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏û‡∏≤‡∏™‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏Å‡∏î "‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô & ‡∏à‡∏±‡∏ö‡∏ö‡∏±‡∏î‡∏î‡∏µ‡πâ"</p>

<div class="row">
<input type="text" id="nameInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
<input type="password" id="passInput" placeholder="‡∏û‡∏≤‡∏™‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î">
<button id="loginBtn">‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô & ‡∏à‡∏±‡∏ö‡∏ö‡∏±‡∏î‡∏î‡∏µ‡πâ</button>
<button id="logoutBtn" class="ghost" style="display:none;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
<button id="resetBtn" class="ghost">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡∏ö‡∏±‡∏î‡∏î‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
</div>

<div id="statusBox" class="status" style="display:none;">
<span id="countText"></span>
</div>

<div id="resultBox" style="display:none;">
<p class="result" id="resultText"></p>
</div>

<footer style="margin-top:15px; text-align:center; font-size:13px; color:#666;">
‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î: Praew, Po, Mark, Mo, Frank, Tuan, Kid
</footer>
</div>

<script>
const NAMES = ["Praew","Po","Mark","Mo","Frank","Tuan","Kid"];
const STORAGE_KEY = "buddy_assignments_pw_v3";

const nameInput = document.getElementById("nameInput");
const passInput = document.getElementById("passInput");
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const resetBtn = document.getElementById("resetBtn");
const resultBox = document.getElementById("resultBox");
const resultText = document.getElementById("resultText");
const countText = document.getElementById("countText");
const statusBox = document.getElementById("statusBox");

// ‡πÅ‡∏Æ‡∏ä‡∏á‡πà‡∏≤‡∏¢ ‡πÜ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏≤‡∏™‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î
function hashString(str) {
  let hash = 0;
  for (let i=0;i<str.length;i++) {
    hash = ((hash<<5)-hash)+str.charCodeAt(i);
    hash |= 0;
  }
  return hash;
}

function loadAssignments() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; } 
  catch { return {}; }
}

function saveAssignments(data) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function updateStatus() {
  const data = loadAssignments();
  const count = Object.keys(data).length;
  countText.innerHTML = `‡∏à‡∏±‡∏ö‡∏ö‡∏±‡∏î‡∏î‡∏µ‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß <b>${count}</b> ‡∏à‡∏≤‡∏Å ${NAMES.length} ‡∏Ñ‡∏ô`;
  statusBox.style.display = "block";
}

function handleLogin() {
  const name = nameInput.value.trim();
  const pass = passInput.value.trim();
  if (!NAMES.includes(name)) {
    alert("‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î");
    return;
  }
  if (!pass) {
    alert("‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏™‡πà‡∏û‡∏≤‡∏™‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì");
    return;
  }

  const data = loadAssignments();
  const passHash = hashString(pass);

  if (data[name]) {
    if (data[name].hash !== passHash) {
      alert("‡∏û‡∏≤‡∏™‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!");
      return;
    }
    resultText.textContent = `‡∏ö‡∏±‡∏î‡∏î‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ ${data[name].buddy}`;
    resultBox.style.display = "block";
    afterLoginUI();
    updateStatus();
    return;
  }

  const used = new Set(Object.values(data).map(x=>x.buddy));
  const available = NAMES.filter(n => !used.has(n) && n !== name);
  if (available.length===0) {
    alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß!");
    return;
  }

  const buddy = available[Math.floor(Math.random()*available.length)];
  data[name] = {buddy: buddy, hash: passHash};
  saveAssignments(data);

  resultText.textContent = `‡∏ö‡∏±‡∏î‡∏î‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ ${buddy}`;
  resultBox.style.display = "block";
  afterLoginUI();
  updateStatus();
}

function afterLoginUI() {
  loginBtn.style.display = "none";
  logoutBtn.style.display = "inline-block";
  nameInput.disabled = true;
  passInput.disabled = true;
}

function handleLogout() {
  loginBtn.style.display = "inline-block";
  logoutBtn.style.display = "none";
  nameInput.disabled = false;
  passInput.disabled = false;
  nameInput.value = "";
  passInput.value = "";
  resultBox.style.display = "none";
}

function handleReset() {
  if(confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡πÑ‡∏´‡∏°‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡∏ö‡∏±‡∏î‡∏î‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) {
    localStorage.removeItem(STORAGE_KEY);
    alert("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
    location.reload();
  }
}

loginBtn.addEventListener("click", handleLogin);
logoutBtn.addEventListener("click", handleLogout);
resetBtn.addEventListener("click", handleReset);

updateStatus();
</script>
</body>
</html>
